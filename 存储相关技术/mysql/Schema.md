# Schema 与数据类型优化

## 数据类型原则
* 更小的通常更好. 
> 一般情况下应该尽量使用可以正确存储数据的最小数据类型
> 但需要确保没有嘀咕需要存储的值的范围，因为修改数据类型是个非常耗时且痛苦的过程(数据量大时)
* 简单就好 
> 简单数据类型的操作通常需要更少的cpu周期，比如整形比字符操作代价更低
* 尽量避免NULL
> nullable的字段使得索引，索引统计和值比较都比较复杂. nullable的字段会使用更多的空间
> NOTE: 通常把nullable字段改成NOT NULL带来的提升比较小. 所以调优时没必要
> 但是如果考虑在列上创建索引时，考虑避免设计为nullable
> 特殊情况：InnoDB 使用单独的位(bit)存储NULL值, 所以对于稀疏数据(只有少数记录是null的情况)有很好的空间效率


### 整数类型

TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT. 分别使用 8 16(short) 24 32(int) 64(long) 存储空间.
整数类型有可选的 UNSIGNED(无符号) 属性.


### 实数类型
实数是带有小数部分的数字. 然而它们不只是为了存储小数部分, 也可以使用 DECIMAL 存储比 BIGINT 还大的整数.

 FLOAT 和 DOUBLE 类型支持使用标准浮点运算运行进行近似计算。

 DECIMAL 

### 字符串类型

varchar 和 char是两种最主要的字符串类型.

varchar 类型用于存储可变长字符串, 是最常见的字符串数据类型。
它比定长类型更节省空间，因为它仅使用必要的空间(越短的字符串使用越少的空间)
PS: ROW_FORMAT=FIXED 设置下除外, 每行都会使用定长存储

varchar 需要1或2个额外字节记录字符串长度(<=255字节时使用1个字节, 否则使用两个字节)

varchar 节省了存储空间, 所以对性能也有帮助.
但是由于行是变长的, 所以在update时可能使得行变得更长, 这就需要做更多的额外工作.
一个记录占用的空间增长, 但是页内没有更多的空间可以存储.


## 4.2 schema 设计中的陷阱
1. 太多的列
2. 太多的关联(join), mysql限制了每个关联操作最多只能61张表. 单个查询最好在12个表以内做关联

